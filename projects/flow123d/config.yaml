name: flow123d
before-run: !readfile utils/setup_env.sh

baselines:
  - commit: b6fa18e97a9f0f2f150f3181846d154f83cee376
    title: 3.0.0
  - commit: d4ae02d538d49f866df002e3ede834a86c5a82fa
    title: 3.0.1

git:
  - https://github.com/flow123d/flow123d.git
  - https://github.com/flow123d/bench_data.git

steps:
  - name: compile
    retries: 2
    stdout: true
    runs: !readfile utils/install.sh
    cache:
      - flow123d/build-<git.branch>
      - build-<git.branch>

  - name: test
    retries: 3
    stdout: true
    variables: !readyaml user/small-serial-set.yaml
    runs:      !readfile utils/runtest.sh
    collect:   !readyaml user/collect.yaml
    # on-success: !readfile utils/delete-tmp.sh
    # on-failure: !readfile utils/delete-tmp.sh
